import{d as M,r as C,q as k,o as z,a as c,b as r,e as t,t as b,k as $,v as S,n as P,h as y,B as G,C as A,x as B,c as E,j as w,F as L,i as I,u as v,l as D}from"./app.eed0d982.js";import{G as R,a as H}from"./useGridProductStore.df2f0e79.js";import{s as q}from"./helpers.ec2122b1.js";const Q={class:"border-y py-3 pl-3 text-left"},W={class:"border-y py-3"},J={class:"border-y py-3 w-32"},K=["placeholder"],O={class:"border-y py-3"},X={class:"flex items-center justify-center"},Y=["disabled"],Z=t("i",{class:"fal fa-angle-left relative top-px"},null,-1),tt=[Z],et={class:"mx-4"},ot=["disabled"],st=t("i",{class:"fal fa-angle-right relative top-px"},null,-1),nt=[st],at={class:"border-y py-3"},lt={class:"border-y py-3"},it=t("i",{class:"fal fa-times"},null,-1),dt=[it],qt=M({__name:"TrProduct",props:["product","refund"],setup(o){const{product:i,refund:f}=o,u=C(i.selled_price),x=a=>a.totalCount--,g=a=>a.totalCount++;return k(()=>i,a=>{a.totalCount>a.count&&(a.totalCount=a.count),a.totalCount<0&&(a.totalCount=0),a.totalCount=Math.round(a.totalCount*1e3)/1e3},{deep:!0}),z(()=>{i.totalCount>i.count&&(i.totalCount=i.count)}),(a,d)=>(c(),r("tr",null,[t("td",Q,b(o.product.product_names.name),1),t("td",W,b(o.product.size.name),1),t("td",J,[$(t("input",{type:"number",class:"text-input border py-0 text-center","onUpdate:modelValue":d[0]||(d[0]=m=>o.product.selled_price=m),placeholder:u.value},null,8,K),[[S,o.product.selled_price]])]),t("td",O,[t("div",X,[t("button",{disabled:o.product.totalCount==0,class:P([{"text-gray-300 hover:bg-inherit":o.product.totalCount==0},"px-3 py-0.5 hover:bg-gray-100 active:bg-gray-200 rounded-sm w-10"]),onClick:d[1]||(d[1]=m=>x(o.product))},tt,10,Y),t("span",et,[$(t("input",{type:"number",class:"text-input border py-0 text-center w-24","onUpdate:modelValue":d[2]||(d[2]=m=>o.product.totalCount=m)},null,512),[[S,o.product.totalCount]])]),t("button",{disabled:o.product.totalCount==o.product.count,class:P([{"text-gray-300 hover:bg-inherit":o.product.totalCount==o.product.count},"px-3 py-0.5 hover:bg-gray-100 active:bg-gray-200 rounded-sm w-10"]),onClick:d[3]||(d[3]=m=>g(o.product))},nt,10,ot)])]),t("td",at,b(o.product.count),1),t("td",lt,b(Math.round(o.product.selled_price*o.product.totalCount*1e3)/1e3),1),o.refund?y("",!0):(c(),r("td",{key:0,onClick:d[4]||(d[4]=m=>a.$emit("delete")),class:"border-y py-3 px-3 text-red-600 cursor-pointer hover:bg-gray-100 active:bg-slate-200"},dt))]))}}),ct=G("GridSold",()=>{const o=C(null),i=C(null);function f(u){o.value.applyTransaction({add:[u],addIndex:0})}return{api:o,columnApi:i,addRow:f}}),rt=G("sumSale",()=>{const o=C({cash:null,electron:null,debt:null});function i(){axios.post("/sale/dayinfo",{from:moment().format(moment.HTML5_FMT.DATE),to:moment().add(1,"days").format(moment.HTML5_FMT.DATE)}).then(({data:f})=>{o.value=q(f)})}return{Summa:o,getDayInfo:i}}),ut={class:"bg-gray-500 bg-opacity-20 w-full h-full absolute z-50 left-0 top-0 flex-center"},mt={key:0,class:"text-right bg-pink-600 border-b mb-0"},ht=t("i",{class:"far fa-times text-white"},null,-1),pt=[ht],ft={key:1,class:"text-right bg-gray-100 border-b mb-0"},bt=t("i",{class:"far fa-times text-red-500"},null,-1),yt=[bt],xt=["onSubmit"],gt={class:"mb-1.5"},_t={class:"text-gray-400 flex-between-center"},vt={key:0},kt={key:1},Ct={key:2},wt=["onClick"],$t=t("i",{class:"fa-solid fa-magnet"},null,-1),St=[$t],Pt=["onClick"],Tt=["onClick"],Mt=["onUpdate:modelValue"],Gt={class:"flex items-center justify-end mt-3"},Dt=t("span",{class:"text-gray-500"}," Umumiy summa: ",-1),Vt={class:"text-xl font-semibold text-gray-600 ml-5"},Nt={key:0,class:"flex items-center justify-end mt-3 text-pink-500"},Ut=t("span",null," Umumiy summadan ortib ketti: ",-1),jt={class:"ml-5"},Ft=["disabled"],zt={key:0},At=t("span",{class:"px-4 text-gray-500"},[D(" Tahrirlash "),t("i",{class:"fa-duotone fa-pen-nib text-pink-500 relative top-px ml-3"})],-1),Bt=[At],Et={key:1},Lt=t("i",{class:"fa-light fa-check ml-3 text-pink-500"},null,-1),Qt=M({__name:"FinishedSold",props:["listProducts","totalPrice","sale"],emits:["sold","close","backup"],setup(o,{emit:i}){const{listProducts:f,totalPrice:u,sale:x}=o,g=R(),a=H(),d=ct(),m=rt(),T=A();function V(s){for(const e in n)e==s?n[e]=u:n[e]=null}function N(s){n[s]=null}function U(s){const e=[];for(const l in n)if(s!=l){const p=["",null].includes(n[l])?0:n[l];e.push(p)}const h=u-e.reduce((l,p)=>l+p,0);n[s]=h==0?null:h}const n=B({cash:u,electron:null,debt:null});k(()=>n.cash,(s,e)=>{(s>u||s<0)&&(n.cash=e)}),k(()=>n.debt,(s,e)=>{(s>u||s<0)&&(n.debt=e)}),k(()=>n.electron,(s,e)=>{(s>u||s<0)&&(n.electron=e)});function j(){const s=f.filter(e=>e.totalCount!=0);x?axios.patch(`sale/${x.id}`,{...n,listProducts:s,shop_id:T.user.active_shop}).then(({data:e})=>{i("backup",e)}):axios.post("sale",{...n,listProducts:s,shop_id:T.user.active_shop}).then(({data:e})=>F(e))}function F(s){s.sells.forEach(e=>{g.api&&g.updateSale(e),a.api&&a.updateSale(e)}),d.api&&d.addRow(s),m.getDayInfo(),i("sold")}const _=E(()=>{const s=[];for(const e in n)s.push(n[e]);return u-s.reduce((e,h)=>{const l=["",null].includes(h)?0:h;return e+l},0)});return(s,e)=>(c(),r("section",ut,[t("main",{onClick:e[3]||(e[3]=w(()=>{},["stop"])),class:"w-96 h-[500px] bg-white shadow-lg flex flex-col"},[o.sale?(c(),r("header",mt,[t("button",{onClick:e[0]||(e[0]=h=>s.$emit("close")),class:"px-4 py-2 hover:bg-pink-500"},pt)])):(c(),r("header",ft,[t("button",{onClick:e[1]||(e[1]=h=>s.$emit("close")),class:"px-4 py-2 hover:bg-gray-200"},yt)])),t("form",{onSubmit:w(j,["prevent"]),class:"p-3 pt-2 flex flex-col justify-between h-full"},[t("main",null,[(c(!0),r(L,null,I(n,(h,l)=>(c(),r("div",gt,[t("aside",_t,[l=="cash"?(c(),r("span",vt,"Naxt")):y("",!0),l=="electron"?(c(),r("span",kt,"Plastik")):y("",!0),l=="debt"?(c(),r("span",Ct,"Qarz")):y("",!0),t("main",null,[t("button",{onClick:p=>U(l),type:"button",class:"text-xs bg-gray-200 text-gray-500 w-10 py-0.5 rounded-sm shadow-sm mr-3 active:bg-pink-400 active:text-white hover:bg-pink-500 hover:text-white"},St,8,wt),t("button",{onClick:p=>N(l),type:"button",class:"text-xs bg-gray-200 text-gray-500 w-10 py-0.5 rounded-sm shadow-sm mr-3 active:bg-pink-400 active:text-white hover:bg-pink-500 hover:text-white"}," 0% ",8,Pt),t("button",{onClick:p=>V(l),type:"button",class:"text-xs bg-gray-200 text-gray-500 w-10 py-0.5 rounded-sm shadow-sm active:bg-pink-400 active:text-white hover:bg-pink-500 hover:text-white"}," 100% ",8,Tt)])]),$(t("input",{onWheel:e[2]||(e[2]=w(()=>{},["prevent"])),type:"number","onUpdate:modelValue":p=>n[l]=p,step:"0.001",class:"text-input text-gray-600"},null,40,Mt),[[S,n[l]]])]))),256)),t("aside",Gt,[Dt,t("span",Vt,b(o.totalPrice),1)]),v(_)<0?(c(),r("aside",Nt,[Ut,t("span",jt,b(v(_)),1)])):y("",!0)]),t("main",null,[t("button",{disabled:v(_)<0,class:P([{"!border-gray-200 text-gray-300 cursor-not-allowed":v(_)<0},"py-1 px-3 bg-gray-200 shadow-md active:shadow-sm border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50 w-full"])},[o.sale?(c(),r("span",zt,Bt)):(c(),r("span",Et,[D(" To'lovni amalga oshirish "),Lt]))],10,Ft)])],40,xt)])]))}});export{ct as G,Qt as _,qt as a,rt as s};
