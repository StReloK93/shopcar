import{c as j,d as L,r as x,a as U,o as S,b as h,e as g,f as r,g as C,w as P,h as w,u as b,i as K,T as M,F as B,j as I,t as N,k as T,l as $,v as F,n as E,m as k,p as A,q as R,s as G,x as O,y as V,z as D,A as Q,B as X}from"./app.8aaa9f41.js";import{_ as q,a as H}from"./FinishedSold.vue_vue_type_script_setup_true_lang.74699eed.js";var z={exports:{}};(function(_,f){(function(n,e){_.exports=e()})(j,function(){var n={attachTo:function(e,t){if(e.scannerDetectionData!==void 0)throw new Error("onScan.js is already initialized for DOM element "+e);var a={onScan:function(s,u){},onScanError:function(s){},onKeyProcess:function(s,u){},onKeyDetect:function(s,u){},onPaste:function(s,u){},keyCodeMapper:function(s){return n.decodeKeyEvent(s)},onScanButtonLongPress:function(){},scanButtonKeyCode:!1,scanButtonLongPressTime:500,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,suffixKeyCodes:[9,13],prefixKeyCodes:[],ignoreIfFocusOn:!1,stopPropagation:!1,preventDefault:!1,captureEvents:!1,reactToKeydown:!0,reactToPaste:!1,singleScanQty:1};return t=this._mergeOptions(a,t),e.scannerDetectionData={options:t,vars:{firstCharTime:0,lastCharTime:0,accumulatedString:"",testTimer:!1,longPressTimeStart:0,longPressed:!1}},t.reactToPaste===!0&&e.addEventListener("paste",this._handlePaste,t.captureEvents),t.scanButtonKeyCode!==!1&&e.addEventListener("keyup",this._handleKeyUp,t.captureEvents),(t.reactToKeydown===!0||t.scanButtonKeyCode!==!1)&&e.addEventListener("keydown",this._handleKeyDown,t.captureEvents),this},detachFrom:function(e){e.scannerDetectionData.options.reactToPaste&&e.removeEventListener("paste",this._handlePaste),e.scannerDetectionData.options.scanButtonKeyCode!==!1&&e.removeEventListener("keyup",this._handleKeyUp),e.removeEventListener("keydown",this._handleKeyDown),e.scannerDetectionData=void 0},getOptions:function(e){return e.scannerDetectionData.options},setOptions:function(e,t){switch(e.scannerDetectionData.options.reactToPaste){case!0:t.reactToPaste===!1&&e.removeEventListener("paste",this._handlePaste);break;case!1:t.reactToPaste===!0&&e.addEventListener("paste",this._handlePaste);break}switch(e.scannerDetectionData.options.scanButtonKeyCode){case!1:t.scanButtonKeyCode!==!1&&e.addEventListener("keyup",this._handleKeyUp);break;default:t.scanButtonKeyCode===!1&&e.removeEventListener("keyup",this._handleKeyUp);break}return e.scannerDetectionData.options=this._mergeOptions(e.scannerDetectionData.options,t),this._reinitialize(e),this},decodeKeyEvent:function(e){var t=this._getNormalizedKeyNum(e);switch(!0){case(t>=48&&t<=90):case(t>=106&&t<=111):if(e.key!==void 0&&e.key!=="")return e.key;var a=String.fromCharCode(t);switch(e.shiftKey){case!1:a=a.toLowerCase();break;case!0:a=a.toUpperCase();break}return a;case(t>=96&&t<=105):return 0+(t-96)}return""},simulate:function(e,t){return this._reinitialize(e),Array.isArray(t)?t.forEach(function(a){var s={};(typeof a=="object"||typeof a=="function")&&a!==null?s=a:s.keyCode=parseInt(a);var u=new KeyboardEvent("keydown",s);document.dispatchEvent(u)}):this._validateScanCode(e,t),this},_reinitialize:function(e){var t=e.scannerDetectionData.vars;t.firstCharTime=0,t.lastCharTime=0,t.accumulatedString=""},_isFocusOnIgnoredElement:function(e){var t=e.scannerDetectionData.options.ignoreIfFocusOn;if(!t)return!1;var a=document.activeElement;if(Array.isArray(t)){for(var s=0;s<t.length;s++)if(a.matches(t[s])===!0)return!0}else if(a.matches(t))return!0;return!1},_validateScanCode:function(e,t){var a=e.scannerDetectionData,s=a.options,u=a.options.singleScanQty,d=a.vars.firstCharTime,m=a.vars.lastCharTime,c={},i;switch(!0){case t.length<s.minLength:c={message:"Receieved code is shorter then minimal length"};break;case m-d>t.length*s.avgTimeByChar:c={message:"Receieved code was not entered in time"};break;default:return s.onScan.call(e,t,u),i=new CustomEvent("scan",{detail:{scanCode:t,qty:u}}),e.dispatchEvent(i),n._reinitialize(e),!0}return c.scanCode=t,c.scanDuration=m-d,c.avgTimeByChar=s.avgTimeByChar,c.minLength=s.minLength,s.onScanError.call(e,c),i=new CustomEvent("scanError",{detail:c}),e.dispatchEvent(i),n._reinitialize(e),!1},_mergeOptions:function(e,t){var a={},s;for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a[s]=e[s]);for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&(a[s]=t[s]);return a},_getNormalizedKeyNum:function(e){return e.which||e.keyCode},_handleKeyDown:function(e){var t=n._getNormalizedKeyNum(e),a=this.scannerDetectionData.options,s=this.scannerDetectionData.vars,u=!1;if(a.onKeyDetect.call(this,t,e)!==!1&&!n._isFocusOnIgnoredElement(this)){if(a.scanButtonKeyCode!==!1&&t==a.scanButtonKeyCode){s.longPressed||(s.longPressTimer=setTimeout(a.onScanButtonLongPress,a.scanButtonLongPressTime,this),s.longPressed=!0);return}switch(!0){case(s.firstCharTime&&a.suffixKeyCodes.indexOf(t)!==-1):e.preventDefault(),e.stopImmediatePropagation(),u=!0;break;case(!s.firstCharTime&&a.prefixKeyCodes.indexOf(t)!==-1):e.preventDefault(),e.stopImmediatePropagation(),u=!1;break;default:var d=a.keyCodeMapper.call(this,e);if(d===null)return;s.accumulatedString+=d,a.preventDefault&&e.preventDefault(),a.stopPropagation&&e.stopImmediatePropagation(),u=!1;break}s.firstCharTime||(s.firstCharTime=Date.now()),s.lastCharTime=Date.now(),s.testTimer&&clearTimeout(s.testTimer),u?(n._validateScanCode(this,s.accumulatedString),s.testTimer=!1):s.testTimer=setTimeout(n._validateScanCode,a.timeBeforeScanTest,this,s.accumulatedString),a.onKeyProcess.call(this,d,e)}},_handlePaste:function(e){var t=this.scannerDetectionData.options,a=this.scannerDetectionData.vars,s=(event.clipboardData||window.clipboardData).getData("text");n._isFocusOnIgnoredElement(this)||(e.preventDefault(),t.stopPropagation&&e.stopImmediatePropagation(),t.onPaste.call(this,s,event),a.firstCharTime=0,a.lastCharTime=0,n._validateScanCode(this,s))},_handleKeyUp:function(e){if(!n._isFocusOnIgnoredElement(this)){var t=n._getNormalizedKeyNum(e);t==this.scannerDetectionData.options.scanButtonKeyCode&&(clearTimeout(this.scannerDetectionData.vars.longPressTimer),this.scannerDetectionData.vars.longPressed=!1)}},isScanInProgressFor:function(e){return e.scannerDetectionData.vars.firstCharTime>0},isAttachedTo:function(e){return e.scannerDetectionData!==void 0}};return n})})(z);const J=z.exports,W={class:"text-right bg-gray-100 border-b mb-0"},Y=r("i",{class:"fa-light fa-minus relative top-px"},null,-1),Z=[Y],ee=r("i",{class:"far fa-times text-red-500"},null,-1),te=[ee],ne={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},se={class:"w-full text-center mt-1"},ae=r("tr",null,[r("td",{class:"py-2 font-semibold"},"Nomi"),r("td",{class:"py-2 font-semibold"},"Hajmi"),r("td",{class:"py-2 font-semibold"},"Narxi"),r("td",{class:"py-2 font-semibold"},"Soni"),r("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),r("td",{class:"py-2 font-semibold"},"Umumiy narxi"),r("td",{class:"py-2 font-semibold"})],-1),ie=r("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),oe=r("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),re={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},ce=r("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),le={class:"bg-white p-3 border-t text-right flex justify-between items-center"},ue=["disabled"],de={key:0},fe={key:1},pe=r("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"},null,-1),he=L({__name:"ListProductsSold",props:["listProducts"],emits:["close","sold","onrollup","onFinished"],setup(_,{emit:f}){const{listProducts:n}=_,e=A("getProductById",null),t=x(),a=x(!1);function s(){e(t.value),t.value=null}const u=U(()=>{const i=n.reduce((o,l)=>o+l.selled_price*l.totalCount,0);return Math.trunc(i*1e3)/1e3});function d(){a.value=!0,f("onFinished",a.value)}function m(){a.value=!1,f("onFinished",a.value)}const c=i=>{n.splice(i,1),n.length==0&&f("close")};return S(()=>{const i=document.getElementById("ListProducts");i.focus(),i.onkeyup=o=>{o.which==13&&o.ctrlKey?d():o.which==27&&f("close")}}),(i,o)=>(h(),g("section",{onClick:o[6]||(o[6]=l=>i.$emit("onrollup")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[r("main",{onClick:o[5]||(o[5]=T(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[C(M,{name:"scale"},{default:P(()=>[a.value?(h(),w(q,{key:0,onClose:m,listProducts:_.listProducts,totalPrice:b(u),onSold:o[0]||(o[0]=l=>i.$emit("sold",l))},null,8,["listProducts","totalPrice"])):K("",!0)]),_:1}),r("header",W,[r("button",{onClick:o[1]||(o[1]=l=>i.$emit("onrollup")),class:"px-4 py-2 hover:bg-gray-200"},Z),r("button",{onClick:o[2]||(o[2]=l=>i.$emit("close")),class:"px-4 py-2 hover:bg-gray-200"},te)]),r("main",ne,[r("table",se,[ae,(h(!0),g(B,null,I(_.listProducts,(l,p)=>(h(),w(H,{product:l,key:p,onDelete:v=>c(p)},null,8,["product","onDelete"]))),128)),r("tr",null,[ie,oe,r("td",re,N(b(u)),1),ce])])]),r("footer",le,[r("form",{onSubmit:o[4]||(o[4]=T(l=>s(),["prevent"]))},[$(r("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":o[3]||(o[3]=l=>t.value=l),placeholder:"Sotish ID-NNN"},null,512),[[F,t.value]])],32),r("button",{disabled:b(u)==0,onClick:d,class:E([{"!border-gray-300 text-gray-400 cursor-disabled bg-gray-300":b(u)==0},"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"])},[b(u)==0?(h(),g("span",de," Mahsulot kiriting ")):(h(),g("span",fe,[k(" Davom ettirish "),pe]))],10,ue)])])]))}}),ve={name:"indexSale",class:"flex flex-col"},me={class:"flex-between-center"},ye=r("i",{class:"fa-light fa-arrow-up-from-dotted-line text-red-600 mr-4"},null,-1),ge=r("span",{class:"px-4"},null,-1),_e=r("i",{class:"fa-light fa-arrow-down-to-dotted-line text-blue-600 mr-4"},null,-1),be={class:"-mb-4 -mx-4 px-3 py-2 relative z-[100] bg-white text-gray-500"},Ce=["onClick"],Pe=r("i",{class:"fa-solid fa-memo mr-1.5"},null,-1),xe=L({__name:"IndexSale",setup(_){const f=x(),n=R({soldGrid:null,textInBarcode:null,listProducts:[],blocker:!0,searchInput:null,activeList:null});G(()=>n.textInBarcode,c=>{var i=null;c==null||n.blocker==!1||(n.blocker=!1,c.includes(window.location.host)?i=c.slice(c.lastIndexOf("/")+1):i=c.replace("product",""),console.log(i),e(i))});function e(c){n.searchInput=null,n.activeList==null&&(n.activeList=n.listProducts.push([])-1);const i=n.listProducts[n.activeList].find(o=>o.id==c);if(i)return i.count>i.totalCount&&i.totalCount++,n.blocker=!0;axios.get(`products/${c}`).then(({data:o})=>{n.blocker=!0,o.id?(o.totalCount=1,o.selled_price=o.price,n.listProducts[n.activeList].push(o)):(n.listProducts[n.activeList].length==0&&(n.listProducts.splice(n.activeList,1),n.activeList=null),swal.fire({text:"Mahsulot mavjud emas!",showCancelButton:!1,timer:1e3}))})}function t(){n.listProducts.splice(n.activeList,1),n.activeList=null,n.blocker=!0,m(!1)}function a(){n.activeList=null,n.blocker=!0}function s(c){n.activeList=null,setTimeout(()=>n.activeList=c,150)}function u(c){c.sells.forEach(i=>{if(f.value.productNames){const l=f.value.productNames.agGrid.api.getRowNode(i.product_names_id),v=l.data.products.find(y=>i.product_id==y.id).count-i.count;v==0?l.data.products=l.data.products.filter(y=>i.product_id!=y.id):l.data.products.forEach(y=>{y.id==i.product_id&&(y.count=v)}),l.setData(l.data)}if(f.value.products){const o=f.value.products.productAgGrid.api,l=o.getRowNode(i.product_id),p=l.data.count-i.count;p==0?o.applyTransaction({remove:[l.data]}):(l.data.count=p,l.setData(l.data))}}),f.value.SellAgGrid&&f.value.SellAgGrid.api.applyTransaction({add:[c],addIndex:0}),t()}document.scannerDetectionData==null&&J.attachTo(document);function d(c){setTimeout(()=>{n.textInBarcode=c.detail.scanCode,setTimeout(()=>n.textInBarcode=null)},50)}S(()=>document.addEventListener("scan",d)),O(()=>document.removeEventListener("scan",d)),X("getProductById",e);function m(c){c?document.removeEventListener("scan",d):document.addEventListener("scan",d)}return(c,i)=>{const o=D("RouterLink"),l=D("RouterView");return h(),g("section",ve,[C(V,{name:"fade"},{default:P(()=>[n.activeList!=null&&n.listProducts[n.activeList].length?(h(),w(he,{key:0,onClose:t,onSold:u,onOnrollup:a,onOnFinished:m,listProducts:n.listProducts[n.activeList]},null,8,["listProducts"])):K("",!0)]),_:1}),r("aside",me,[r("div",null,[C(o,{to:"/soldproducts",class:"py-1.5 inline-block"},{default:P(()=>[ye,k(" Sotilgan ")]),_:1}),ge,C(o,{to:"/existproduct",class:"py-1.5 inline-block"},{default:P(()=>[_e,k(" Do'kondagi ")]),_:1})]),r("form",{onSubmit:i[1]||(i[1]=T(p=>e(n.searchInput),["prevent"]))},[$(r("input",{type:"text",class:"text-input bg-inherit text-center text-gray-600","onUpdate:modelValue":i[0]||(i[0]=p=>n.searchInput=p),placeholder:"Sotish ID-XXX"},null,512),[[F,n.searchInput]])],32)]),C(l,null,{default:P(({Component:p})=>[(h(),w(Q(p),{ref_key:"tables",ref:f,class:"h-full"},null,512))]),_:1}),r("main",be,[(h(!0),g(B,null,I(n.listProducts,(p,v)=>(h(),g("button",{onClick:y=>s(v),key:v,class:E([{"bg-pink-500 text-white":v==n.activeList},"px-3 py-1 bg-gray-200 rounded-sm mr-3 border-b border-pink-600 transition-all"])},[Pe,k(" "+N(v+1),1)],10,Ce))),128))])])}}});export{xe as default};
