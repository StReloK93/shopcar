import{c as z,d as L,r as P,a as U,o as S,b as h,e as g,f as r,g as x,w,h as C,u as _,i as K,T as M,F as B,j as I,t as N,k as T,l as $,v as F,n as E,m as k,p as A,q as R,s as V,x as G,y as O,z as Q,A as D,B as X,C as q}from"./app.a40bcdf9.js";import{_ as H,a as J}from"./FinishedSold.vue_vue_type_script_setup_true_lang.0d66a830.js";var j={exports:{}};(function(b,f){(function(s,e){b.exports=e()})(z,function(){var s={attachTo:function(e,t){if(e.scannerDetectionData!==void 0)throw new Error("onScan.js is already initialized for DOM element "+e);var a={onScan:function(n,d){},onScanError:function(n){},onKeyProcess:function(n,d){},onKeyDetect:function(n,d){},onPaste:function(n,d){},keyCodeMapper:function(n){return s.decodeKeyEvent(n)},onScanButtonLongPress:function(){},scanButtonKeyCode:!1,scanButtonLongPressTime:500,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,suffixKeyCodes:[9,13],prefixKeyCodes:[],ignoreIfFocusOn:!1,stopPropagation:!1,preventDefault:!1,captureEvents:!1,reactToKeydown:!0,reactToPaste:!1,singleScanQty:1};return t=this._mergeOptions(a,t),e.scannerDetectionData={options:t,vars:{firstCharTime:0,lastCharTime:0,accumulatedString:"",testTimer:!1,longPressTimeStart:0,longPressed:!1}},t.reactToPaste===!0&&e.addEventListener("paste",this._handlePaste,t.captureEvents),t.scanButtonKeyCode!==!1&&e.addEventListener("keyup",this._handleKeyUp,t.captureEvents),(t.reactToKeydown===!0||t.scanButtonKeyCode!==!1)&&e.addEventListener("keydown",this._handleKeyDown,t.captureEvents),this},detachFrom:function(e){e.scannerDetectionData.options.reactToPaste&&e.removeEventListener("paste",this._handlePaste),e.scannerDetectionData.options.scanButtonKeyCode!==!1&&e.removeEventListener("keyup",this._handleKeyUp),e.removeEventListener("keydown",this._handleKeyDown),e.scannerDetectionData=void 0},getOptions:function(e){return e.scannerDetectionData.options},setOptions:function(e,t){switch(e.scannerDetectionData.options.reactToPaste){case!0:t.reactToPaste===!1&&e.removeEventListener("paste",this._handlePaste);break;case!1:t.reactToPaste===!0&&e.addEventListener("paste",this._handlePaste);break}switch(e.scannerDetectionData.options.scanButtonKeyCode){case!1:t.scanButtonKeyCode!==!1&&e.addEventListener("keyup",this._handleKeyUp);break;default:t.scanButtonKeyCode===!1&&e.removeEventListener("keyup",this._handleKeyUp);break}return e.scannerDetectionData.options=this._mergeOptions(e.scannerDetectionData.options,t),this._reinitialize(e),this},decodeKeyEvent:function(e){var t=this._getNormalizedKeyNum(e);switch(!0){case(t>=48&&t<=90):case(t>=106&&t<=111):if(e.key!==void 0&&e.key!=="")return e.key;var a=String.fromCharCode(t);switch(e.shiftKey){case!1:a=a.toLowerCase();break;case!0:a=a.toUpperCase();break}return a;case(t>=96&&t<=105):return 0+(t-96)}return""},simulate:function(e,t){return this._reinitialize(e),Array.isArray(t)?t.forEach(function(a){var n={};(typeof a=="object"||typeof a=="function")&&a!==null?n=a:n.keyCode=parseInt(a);var d=new KeyboardEvent("keydown",n);document.dispatchEvent(d)}):this._validateScanCode(e,t),this},_reinitialize:function(e){var t=e.scannerDetectionData.vars;t.firstCharTime=0,t.lastCharTime=0,t.accumulatedString=""},_isFocusOnIgnoredElement:function(e){var t=e.scannerDetectionData.options.ignoreIfFocusOn;if(!t)return!1;var a=document.activeElement;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if(a.matches(t[n])===!0)return!0}else if(a.matches(t))return!0;return!1},_validateScanCode:function(e,t){var a=e.scannerDetectionData,n=a.options,d=a.options.singleScanQty,u=a.vars.firstCharTime,m=a.vars.lastCharTime,l={},i;switch(!0){case t.length<n.minLength:l={message:"Receieved code is shorter then minimal length"};break;case m-u>t.length*n.avgTimeByChar:l={message:"Receieved code was not entered in time"};break;default:return n.onScan.call(e,t,d),i=new CustomEvent("scan",{detail:{scanCode:t,qty:d}}),e.dispatchEvent(i),s._reinitialize(e),!0}return l.scanCode=t,l.scanDuration=m-u,l.avgTimeByChar=n.avgTimeByChar,l.minLength=n.minLength,n.onScanError.call(e,l),i=new CustomEvent("scanError",{detail:l}),e.dispatchEvent(i),s._reinitialize(e),!1},_mergeOptions:function(e,t){var a={},n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n]);return a},_getNormalizedKeyNum:function(e){return e.which||e.keyCode},_handleKeyDown:function(e){var t=s._getNormalizedKeyNum(e),a=this.scannerDetectionData.options,n=this.scannerDetectionData.vars,d=!1;if(a.onKeyDetect.call(this,t,e)!==!1&&!s._isFocusOnIgnoredElement(this)){if(a.scanButtonKeyCode!==!1&&t==a.scanButtonKeyCode){n.longPressed||(n.longPressTimer=setTimeout(a.onScanButtonLongPress,a.scanButtonLongPressTime,this),n.longPressed=!0);return}switch(!0){case(n.firstCharTime&&a.suffixKeyCodes.indexOf(t)!==-1):e.preventDefault(),e.stopImmediatePropagation(),d=!0;break;case(!n.firstCharTime&&a.prefixKeyCodes.indexOf(t)!==-1):e.preventDefault(),e.stopImmediatePropagation(),d=!1;break;default:var u=a.keyCodeMapper.call(this,e);if(u===null)return;n.accumulatedString+=u,a.preventDefault&&e.preventDefault(),a.stopPropagation&&e.stopImmediatePropagation(),d=!1;break}n.firstCharTime||(n.firstCharTime=Date.now()),n.lastCharTime=Date.now(),n.testTimer&&clearTimeout(n.testTimer),d?(s._validateScanCode(this,n.accumulatedString),n.testTimer=!1):n.testTimer=setTimeout(s._validateScanCode,a.timeBeforeScanTest,this,n.accumulatedString),a.onKeyProcess.call(this,u,e)}},_handlePaste:function(e){var t=this.scannerDetectionData.options,a=this.scannerDetectionData.vars,n=(event.clipboardData||window.clipboardData).getData("text");s._isFocusOnIgnoredElement(this)||(e.preventDefault(),t.stopPropagation&&e.stopImmediatePropagation(),t.onPaste.call(this,n,event),a.firstCharTime=0,a.lastCharTime=0,s._validateScanCode(this,n))},_handleKeyUp:function(e){if(!s._isFocusOnIgnoredElement(this)){var t=s._getNormalizedKeyNum(e);t==this.scannerDetectionData.options.scanButtonKeyCode&&(clearTimeout(this.scannerDetectionData.vars.longPressTimer),this.scannerDetectionData.vars.longPressed=!1)}},isScanInProgressFor:function(e){return e.scannerDetectionData.vars.firstCharTime>0},isAttachedTo:function(e){return e.scannerDetectionData!==void 0}};return s})})(j);const W=j.exports,Y={class:"text-right bg-gray-100 border-b mb-0"},Z=r("i",{class:"fa-light fa-minus relative top-px"},null,-1),ee=[Z],te=r("i",{class:"far fa-times text-red-500"},null,-1),se=[te],ne={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},ae={class:"w-full text-center mt-1"},ie=r("tr",null,[r("td",{class:"py-2 font-semibold"},"Nomi"),r("td",{class:"py-2 font-semibold"},"Hajmi"),r("td",{class:"py-2 font-semibold"},"Narxi"),r("td",{class:"py-2 font-semibold"},"Soni"),r("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),r("td",{class:"py-2 font-semibold"},"Umumiy narxi"),r("td",{class:"py-2 font-semibold"})],-1),oe=r("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),re=r("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),le={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},ce=r("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),de={class:"bg-white p-3 border-t text-right flex justify-between items-center"},ue=["disabled"],fe={key:0},pe={key:1},he=r("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"},null,-1),ve=L({__name:"ListProductsSold",props:["listProducts"],emits:["close","sold","onrollup","onFinished"],setup(b,{emit:f}){const{listProducts:s}=b,e=A("getProductById",null),t=P(),a=P(!1);function n(){e(t.value),t.value=null}const d=U(()=>{const i=s.reduce((o,c)=>o+c.selled_price*c.totalCount,0);return Math.trunc(i*1e3)/1e3});function u(){a.value=!0,f("onFinished",a.value)}function m(){a.value=!1,f("onFinished",a.value)}const l=i=>{s.splice(i,1),s.length==0&&f("close")};return S(()=>{const i=document.getElementById("ListProducts");i.focus(),i.onkeyup=o=>{o.which==13&&o.ctrlKey?u():o.which==27&&f("close")}}),(i,o)=>(h(),g("section",{onClick:o[6]||(o[6]=c=>i.$emit("onrollup")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[r("main",{onClick:o[5]||(o[5]=T(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[x(M,{name:"scale"},{default:w(()=>[a.value?(h(),C(H,{key:0,onClose:m,listProducts:b.listProducts,totalPrice:_(d),onSold:o[0]||(o[0]=c=>i.$emit("sold",c))},null,8,["listProducts","totalPrice"])):K("",!0)]),_:1}),r("header",Y,[r("button",{onClick:o[1]||(o[1]=c=>i.$emit("onrollup")),class:"px-4 py-2 hover:bg-gray-200"},ee),r("button",{onClick:o[2]||(o[2]=c=>i.$emit("close")),class:"px-4 py-2 hover:bg-gray-200"},se)]),r("main",ne,[r("table",ae,[ie,(h(!0),g(B,null,I(b.listProducts,(c,p)=>(h(),C(J,{product:c,key:p,onDelete:v=>l(p)},null,8,["product","onDelete"]))),128)),r("tr",null,[oe,re,r("td",le,N(_(d)),1),ce])])]),r("footer",de,[r("form",{onSubmit:o[4]||(o[4]=T(c=>n(),["prevent"]))},[$(r("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":o[3]||(o[3]=c=>t.value=c),placeholder:"Sotish ID-NNN"},null,512),[[F,t.value]])],32),r("button",{disabled:_(d)==0,onClick:u,class:E([{"!border-gray-300 text-gray-400 cursor-disabled bg-gray-300":_(d)==0},"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"])},[_(d)==0?(h(),g("span",fe," Mahsulot kiriting ")):(h(),g("span",pe,[k(" Davom ettirish "),he]))],10,ue)])])]))}}),me={name:"indexSale",class:"flex flex-col"},ye=Q('<section class="mb-2 flex text-gray-700 justify-end"><div class="bg-gray-50 px-2 py-1.5 shadow-sm rounded w-32"><p class="text-sm text-gray-400 leading-none mb-2 flex justify-between"><span> Naxt </span><i class="fa-light fa-sack-dollar text-teal-600"></i></p><div class="leading-none font-semibold"> 12450000 </div></div><div class="bg-gray-50 px-2 py-1.5 shadow-sm rounded w-32 mx-6"><p class="text-sm text-gray-400 leading-none mb-2 flex justify-between"><span> Plastik </span><i class="fa-light fa-money-check-dollar text-sky-600"></i></p><div class="leading-none font-semibold"> 12450000 </div></div><div class="bg-gray-50 px-2 py-1.5 shadow-sm rounded w-32"><p class="text-sm text-gray-400 leading-none mb-2 flex justify-between"><span> Qarz </span><i class="fa-light fa-money-check-dollar-pen text-pink-600"></i></p><div class="leading-none font-semibold"> 12450000 </div></div></section>',1),ge={class:"flex-between-center"},be=r("i",{class:"fa-light fa-arrow-up-from-dotted-line text-red-600 mr-4"},null,-1),_e=r("span",{class:"px-4"},null,-1),xe=r("i",{class:"fa-light fa-arrow-down-to-dotted-line text-blue-600 mr-4"},null,-1),we={class:"-mb-4 -mx-4 px-3 py-2 relative z-[100] bg-white text-gray-500"},ke=["onClick"],Ce=r("i",{class:"fa-solid fa-memo mr-1.5"},null,-1),De=L({__name:"IndexSale",setup(b){const f=P(),s=R({soldGrid:null,textInBarcode:null,listProducts:[],blocker:!0,searchInput:null,activeList:null});V(()=>s.textInBarcode,l=>{var i=null;l==null||s.blocker==!1||(s.blocker=!1,l.includes(window.location.host)?i=l.slice(l.lastIndexOf("/")+1):i=l.replace("product",""),console.log(i),e(i))});function e(l){s.searchInput=null,s.activeList==null&&(s.activeList=s.listProducts.push([])-1);const i=s.listProducts[s.activeList].find(o=>o.id==l);if(i)return i.count>i.totalCount&&i.totalCount++,s.blocker=!0;axios.get(`products/${l}`).then(({data:o})=>{s.blocker=!0,o.id?(o.totalCount=1,o.selled_price=o.price,s.listProducts[s.activeList].push(o)):(s.listProducts[s.activeList].length==0&&(s.listProducts.splice(s.activeList,1),s.activeList=null),swal.fire({text:"Mahsulot mavjud emas!",showCancelButton:!1,timer:1e3}))})}function t(){s.listProducts.splice(s.activeList,1),s.activeList=null,s.blocker=!0,m(!1)}function a(){s.activeList=null,s.blocker=!0}function n(l){s.activeList=null,setTimeout(()=>s.activeList=l,150)}function d(l){l.sells.forEach(i=>{if(f.value.productNames){const c=f.value.productNames.agGrid.api.getRowNode(i.product_names_id),v=c.data.products.find(y=>i.product_id==y.id).count-i.count;v==0?c.data.products=c.data.products.filter(y=>i.product_id!=y.id):c.data.products.forEach(y=>{y.id==i.product_id&&(y.count=v)}),c.setData(c.data)}if(f.value.products){const o=f.value.products.productAgGrid.api,c=o.getRowNode(i.product_id),p=c.data.count-i.count;p==0?o.applyTransaction({remove:[c.data]}):(c.data.count=p,c.setData(c.data))}}),f.value.SellAgGrid&&f.value.SellAgGrid.api.applyTransaction({add:[l],addIndex:0}),t()}document.scannerDetectionData==null&&W.attachTo(document);function u(l){setTimeout(()=>{s.textInBarcode=l.detail.scanCode,setTimeout(()=>s.textInBarcode=null)},50)}S(()=>document.addEventListener("scan",u)),G(()=>document.removeEventListener("scan",u)),q("getProductById",e);function m(l){l?document.removeEventListener("scan",u):document.addEventListener("scan",u)}return(l,i)=>{const o=D("RouterLink"),c=D("RouterView");return h(),g("section",me,[x(O,{name:"fade"},{default:w(()=>[s.activeList!=null&&s.listProducts[s.activeList].length?(h(),C(ve,{key:0,onClose:t,onSold:d,onOnrollup:a,onOnFinished:m,listProducts:s.listProducts[s.activeList]},null,8,["listProducts"])):K("",!0)]),_:1}),ye,r("aside",ge,[r("div",null,[x(o,{to:"/soldproducts",class:"py-1.5 inline-block"},{default:w(()=>[be,k(" Sotilgan ")]),_:1}),_e,x(o,{to:"/existproduct",class:"py-1.5 inline-block"},{default:w(()=>[xe,k(" Do'kondagi ")]),_:1})]),r("form",{onSubmit:i[1]||(i[1]=T(p=>e(s.searchInput),["prevent"]))},[$(r("input",{type:"text",class:"text-input bg-inherit text-center text-gray-600","onUpdate:modelValue":i[0]||(i[0]=p=>s.searchInput=p),placeholder:"Sotish ID-XXX"},null,512),[[F,s.searchInput]])],32)]),x(c,null,{default:w(({Component:p})=>[(h(),C(X(p),{ref_key:"tables",ref:f,class:"h-full"},null,512))]),_:1}),r("main",we,[(h(!0),g(B,null,I(s.listProducts,(p,v)=>(h(),g("button",{onClick:y=>n(v),key:v,class:E([{"bg-pink-500 text-white":v==s.activeList},"px-3 py-1 bg-gray-200 rounded-sm mr-3 border-b border-pink-600 transition-all"])},[Ce,k(" "+N(v+1),1)],10,ke))),128))])])}}});export{De as default};
