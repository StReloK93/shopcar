import{d as P,r as g,a as N,o as F,b as f,e as y,f as e,g as v,w as D,h as w,u as _,i as I,T,F as V,j,t as A,k as $,l as G,v as z,m as R,p as E,q as C,y as L,z as M,D as U,E as q,_ as Q}from"./app.0e1eeed2.js";import{_ as H,a as K}from"./FinishedSold.vue_vue_type_script_setup_true_lang.775159ab.js";const J={class:"flex justify-between items-center bg-pink-600 border-b mb-0"},O=e("span",{class:"px-4 text-white"},[e("i",{class:"fa-duotone fa-pen-nib text-white relative top-px mr-3"}),R(" Tahrirlash ")],-1),W=e("i",{class:"far fa-times text-white"},null,-1),X=[W],Y={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},Z={class:"w-full text-center mt-1"},ee=e("tr",null,[e("td",{class:"py-2 font-semibold"},"Nomi"),e("td",{class:"py-2 font-semibold"},"Hajmi"),e("td",{class:"py-2 font-semibold"},"Narxi"),e("td",{class:"py-2 font-semibold"},"Soni"),e("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),e("td",{class:"py-2 font-semibold"},"Umumiy narxi")],-1),te=e("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),se=e("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),oe={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},le=e("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),ne={class:"bg-white p-3 border-t text-right flex justify-between items-center"},ae=e("span",{class:"text-gray-600"},[R(" Davom ettirish "),e("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"})],-1),ie=[ae],de=P({__name:"RefundListProducts",props:["product"],emits:["close","deleted","onFinished","backup"],setup(c,{emit:h}){const{product:k}=c,n=E("getProductById",null),m=g(),u=g(!1),p=g([]),a=g([]);axios.get(`sale/${k.id}`).then(({data:o})=>{o.sells.forEach(s=>{s.totalCount=s.count}),p.value=o.sells,a.value=[...o.sells]});function x(){n(m.value),m.value=null}const t=N(()=>{const o=p.value.reduce((s,l)=>s+l.selled_price*l.totalCount,0);return Math.trunc(o*1e3)/1e3}),i=N(()=>a.value.map(o=>{const s=p.value.find(b=>o.id==b.id),l=o.count-s.totalCount;return{...s,totalCount:l}}));function d(){u.value=!0,h("onFinished",u.value)}function r(){u.value=!1,h("onFinished",u.value)}const S=o=>{p.value.splice(o,1)};return F(()=>{const o=document.getElementById("ListProducts");o.focus(),o.onkeyup=s=>{s.which==13&&s.ctrlKey?d():s.which==27&&h("close")}}),(o,s)=>(f(),y("section",{onClick:s[5]||(s[5]=l=>o.$emit("close")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[e("main",{onClick:s[4]||(s[4]=$(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[v(T,{name:"scale"},{default:D(()=>[u.value?(f(),w(H,{key:0,onClose:r,onBackup:s[0]||(s[0]=l=>o.$emit("backup",l)),listProducts:_(i),totalPrice:_(t),sale:c.product},null,8,["listProducts","totalPrice","sale"])):I("",!0)]),_:1}),e("header",J,[O,e("button",{onClick:s[1]||(s[1]=l=>o.$emit("close")),class:"px-4 py-2 hover:bg-pink-500"},X)]),e("main",Y,[e("table",Z,[ee,(f(!0),y(V,null,j(p.value,(l,b)=>(f(),w(K,{refund:!0,product:l,key:b,onDelete:he=>S(b)},null,8,["product","onDelete"]))),128)),e("tr",null,[te,se,e("td",oe,A(_(t)),1),le])])]),e("footer",ne,[e("form",{onSubmit:s[3]||(s[3]=$(l=>x(),["prevent"]))},[G(e("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":s[2]||(s[2]=l=>m.value=l),placeholder:"Sotish ID-NNN"},null,512),[[z,m.value]])],32),e("main",null,[e("button",{onClick:d,class:"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"},ie)])])])]))}}),B=c=>(U("data-v-a484d773"),c=c(),q(),c),re={class:"flex flex-col"},ce={class:"bg-white px-1 py-2 flex items-center"},ue=B(()=>e("label",{for:"searchInput"},null,-1)),pe=B(()=>e("i",{class:"fal fa-search text-sm mr-4 relative top-px"},null,-1)),me={class:"flex-grow"},fe=P({__name:"SoldProducts",emits:["editSold"],setup(c,{expose:h,emit:k}){axios.get("sale").then(({data:t})=>n.sells=t);const n=C({sells:null,editSold:null,columnDefs:[{headerName:"Mahsulotlar",flex:1,sortable:!0,cellRenderer:t=>{var i="";return t.data.sells.forEach(d=>{var r=d.count>1?`<span class="text-[10px] text-pink-500 mr-0.5">${d.count}x </span>`:"";i+=`
                    <div class="inline-block mr-4 ">
                        <span class="bg-gray-100 px-2 py-0.5 border-b border-pink-500">
                            <span>${d.product_names.name}</span>
                            <span class="ml-4 text-gray-400"> ${r} ${d.size.name}</span>
                        </span>
                    </div>`}),i}},{field:"cash",headerName:"Naxt",width:130},{field:"electron",headerName:"Plastik",width:130},{field:"debt",headerName:"Qarz",width:80},{field:"count",headerName:"Summa",width:140,headerClass:["bg-gray-100"],cellClass:["bg-gray-100","font-semibold"],cellRenderer:({data:t})=>t.cash+t.electron+t.debt},{field:"created_at",headerName:"Sotilgan vaqt",width:140,cellRenderer:t=>moment(t.value).fromNow()},{headerName:"",width:50,cellRenderer:()=>"<i class='fa-duotone fa-pen-nib text-pink-600 text-[16px] relative top-px'></i>",onCellClicked:t=>u(t.data),cellClass:["hover:bg-gray-200","text-center","active:bg-gray-300","bg-gray-100"]}]});function m(t){t==!1?(a.api.applyTransaction({remove:[n.editSold]}),n.editSold=null):(a.api.getRowNode(t.id).setData(t),n.editSold=null)}function u(t){n.editSold=t}function p(t){a.api.applyTransaction({remove:[t]})}const a=C({api:null,columnApi:null});function x(t){a.api=t.api,a.columnApi=t.columnApi}return h({SellAgGrid:a}),(t,i)=>{const d=M("AgGridVue");return f(),y("aside",re,[v(L,{name:"fade"},{default:D(()=>[n.editSold!=null?(f(),w(de,{key:0,onClose:i[0]||(i[0]=r=>n.editSold=null),onDeleted:p,onBackup:m,product:n.editSold},null,8,["product"])):I("",!0)]),_:1}),e("section",ce,[ue,pe,e("input",{onInput:i[1]||(i[1]=r=>a.api.setQuickFilter(r.target.value)),id:"searchInput",type:"text",class:"py-0.5 bg-inherit w-full outline-none",placeholder:"Izlash"},null,32)]),e("section",me,[v(d,{class:"h-full ag-theme-alpine w-full",getRowId:r=>r.data.id,rowData:n.sells,columnDefs:n.columnDefs,animateRows:!0,onGridReady:x},null,8,["getRowId","rowData","columnDefs"])])])}}});const xe=Q(fe,[["__scopeId","data-v-a484d773"]]);export{xe as default};
