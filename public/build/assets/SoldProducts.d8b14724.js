import{d as P,r as b,a as $,o as B,b as m,e as v,f as e,g as w,w as D,h as _,u as y,i as I,T as F,F as T,j as V,t as j,k as C,l as A,v as z,m as R,p as G,q as S,y as L,z as M}from"./app.f554c489.js";import{_ as E,a as U}from"./FinishedSold.vue_vue_type_script_setup_true_lang.616c7fd3.js";const q={class:"flex justify-between items-center bg-pink-600 border-b mb-0"},Q=e("span",{class:"px-4 text-white"},[e("i",{class:"fa-duotone fa-pen-nib text-white relative top-px mr-3"}),R(" Tahrirlash ")],-1),H=e("i",{class:"far fa-times text-white"},null,-1),K=[H],J={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},O={class:"w-full text-center mt-1"},W=e("tr",null,[e("td",{class:"py-2 font-semibold"},"Nomi"),e("td",{class:"py-2 font-semibold"},"Hajmi"),e("td",{class:"py-2 font-semibold"},"Narxi"),e("td",{class:"py-2 font-semibold"},"Soni"),e("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),e("td",{class:"py-2 font-semibold"},"Umumiy narxi")],-1),X=e("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),Y=e("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),Z={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},ee=e("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),te={class:"bg-white p-3 border-t text-right flex justify-between items-center"},se=e("span",{class:"text-gray-600"},[R(" Davom ettirish "),e("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"})],-1),oe=[se],le=P({__name:"RefundListProducts",props:["product"],emits:["close","deleted","onFinished","backup"],setup(g,{emit:f}){const{product:k}=g,n=G("getProductById",null),p=b(),c=b(!1),u=b([]),a=b([]);axios.get(`sale/${k.id}`).then(({data:o})=>{o.sells.forEach(s=>{s.totalCount=s.count}),u.value=o.sells,a.value=[...o.sells]});function x(){n(p.value),p.value=null}const t=$(()=>{const o=u.value.reduce((s,l)=>s+l.selled_price*l.totalCount,0);return Math.trunc(o*1e3)/1e3}),i=$(()=>a.value.map(o=>{const s=u.value.find(h=>o.id==h.id),l=o.count-s.totalCount;return{...s,totalCount:l}}));function r(){c.value=!0,f("onFinished",c.value)}function d(){c.value=!1,f("onFinished",c.value)}const N=o=>{u.value.splice(o,1)};return B(()=>{const o=document.getElementById("ListProducts");o.focus(),o.onkeyup=s=>{s.which==13&&s.ctrlKey?r():s.which==27&&f("close")}}),(o,s)=>(m(),v("section",{onClick:s[5]||(s[5]=l=>o.$emit("close")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[e("main",{onClick:s[4]||(s[4]=C(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[w(F,{name:"scale"},{default:D(()=>[c.value?(m(),_(E,{key:0,onClose:d,onBackup:s[0]||(s[0]=l=>o.$emit("backup",l)),listProducts:y(i),totalPrice:y(t),sale:g.product},null,8,["listProducts","totalPrice","sale"])):I("",!0)]),_:1}),e("header",q,[Q,e("button",{onClick:s[1]||(s[1]=l=>o.$emit("close")),class:"px-4 py-2 hover:bg-pink-500"},K)]),e("main",J,[e("table",O,[W,(m(!0),v(T,null,V(u.value,(l,h)=>(m(),_(U,{refund:!0,product:l,key:h,onDelete:ce=>N(h)},null,8,["product","onDelete"]))),128)),e("tr",null,[X,Y,e("td",Z,j(y(t)),1),ee])])]),e("footer",te,[e("form",{onSubmit:s[3]||(s[3]=C(l=>x(),["prevent"]))},[A(e("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":s[2]||(s[2]=l=>p.value=l),placeholder:"Sotish ID-NNN"},null,512),[[z,p.value]])],32),e("main",null,[e("button",{onClick:r,class:"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"},oe)])])])]))}}),ne={class:"flex flex-col"},ae={class:"bg-white px-1 py-2 flex items-center"},ie=e("label",{for:"searchInput"},null,-1),re=e("i",{class:"fal fa-search text-sm mr-4 relative top-px"},null,-1),de={class:"flex-grow"},me=P({__name:"SoldProducts",emits:["editSold"],setup(g,{expose:f,emit:k}){axios.get("sale").then(({data:t})=>n.sells=t);const n=S({sells:null,editSold:null,columnDefs:[{headerName:"Mahsulotlar",flex:1,sortable:!0,cellRenderer:t=>{var i="";return t.data.sells.forEach(r=>{var d=r.count>1?`<span class="text-[10px] text-pink-500 mr-0.5">${r.count}x </span>`:"";i+=`
                    <div class="inline-block mr-4 ">
                        <span class="bg-gray-100 px-2 py-0.5 border-b border-pink-500">
                            <span>${r.product_names.name}</span>
                            <span class="ml-4 text-gray-400"> ${d} ${r.size.name}</span>
                        </span>
                    </div>`}),i}},{field:"cash",headerName:"Naxt",width:130},{field:"electron",headerName:"Plastik",width:130},{field:"debt",headerName:"Qarz",width:80},{field:"count",headerName:"Summa",width:140,headerClass:["bg-gray-100"],cellClass:["bg-gray-100","font-semibold"],cellRenderer:({data:t})=>t.cash+t.electron+t.debt},{field:"created_at",headerName:"Sotilgan vaqt",width:140,cellRenderer:t=>moment(t.value).fromNow()},{headerName:"",width:50,cellRenderer:()=>"<i class='fa-duotone fa-pen-nib text-pink-600 text-[16px] relative top-px'></i>",onCellClicked:t=>c(t.data),cellClass:["hover:bg-gray-200","text-center","active:bg-gray-300","bg-gray-100"]}]});function p(t){t==!1?(a.api.applyTransaction({remove:[n.editSold]}),n.editSold=null):(a.api.getRowNode(t.id).setData(t),n.editSold=null)}function c(t){n.editSold=t}function u(t){a.api.applyTransaction({remove:[t]})}const a=S({api:null,columnApi:null});function x(t){a.api=t.api,a.columnApi=t.columnApi}return f({SellAgGrid:a}),(t,i)=>{const r=M("AgGridVue");return m(),v("aside",ne,[w(L,{name:"fade"},{default:D(()=>[n.editSold!=null?(m(),_(le,{key:0,onClose:i[0]||(i[0]=d=>n.editSold=null),onDeleted:u,onBackup:p,product:n.editSold},null,8,["product"])):I("",!0)]),_:1}),e("section",ae,[ie,re,e("input",{onInput:i[1]||(i[1]=d=>a.api.setQuickFilter(d.target.value)),id:"searchInput",type:"text",class:"py-0.5 bg-inherit w-full outline-none",placeholder:"Izlash"},null,32)]),e("section",de,[w(r,{class:"h-full ag-theme-alpine w-full",getRowId:d=>d.data.id,rowData:n.sells,columnDefs:n.columnDefs,animateRows:!0,onGridReady:x},null,8,["getRowId","rowData","columnDefs"])])])}}});export{me as default};
