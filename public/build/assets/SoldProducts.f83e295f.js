import{d as $,r as x,c as S,o as B,a as f,b as y,e,f as v,w as C,g as w,u as _,h as D,T as F,F as G,i as T,t as V,j as N,k as j,v as z,l as P,m as A,x as E,s as L,y as M,z as U,D as H,E as Q,_ as q}from"./app.eed0d982.js";import{_ as K,a as J,s as O,G as W}from"./FinishedSold.vue_vue_type_script_setup_true_lang.57c98ec9.js";import"./useGridProductStore.df2f0e79.js";import"./helpers.ec2122b1.js";const X={class:"flex justify-between items-center bg-pink-600 border-b mb-0"},Y=e("span",{class:"px-4 text-white"},[e("i",{class:"fa-duotone fa-pen-nib text-white relative top-px mr-3"}),P(" Tahrirlash ")],-1),Z=e("i",{class:"far fa-times text-white"},null,-1),ee=[Z],te={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},se={class:"w-full text-center mt-1"},oe=e("tr",null,[e("td",{class:"py-2 font-semibold"},"Nomi"),e("td",{class:"py-2 font-semibold"},"Hajmi"),e("td",{class:"py-2 font-semibold"},"Narxi"),e("td",{class:"py-2 font-semibold"},"Soni"),e("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),e("td",{class:"py-2 font-semibold"},"Umumiy narxi")],-1),le=e("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),ne=e("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),ae={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},ie=e("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),re={class:"bg-white p-3 border-t text-right flex justify-between items-center"},de=e("span",{class:"text-gray-600"},[P(" Davom ettirish "),e("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"})],-1),ce=[de],ue=$({__name:"RefundListProducts",props:["product"],emits:["close","deleted","onFinished","backup"],setup(c,{emit:h}){const{product:i}=c,n=A("getProductById",null),m=x(),u=x(!1),p=x([]),b=x([]);axios.get(`sale/${i.id}`).then(({data:o})=>{o.sells.forEach(s=>{s.totalCount=s.count}),p.value=o.sells,b.value=[...o.sells]});function t(){n(m.value),m.value=null}const a=S(()=>{const o=p.value.reduce((s,l)=>s+l.selled_price*l.totalCount,0);return Math.trunc(o*1e3)/1e3}),d=S(()=>b.value.map(o=>{const s=p.value.find(g=>o.id==g.id),l=o.count-s.totalCount;return{...s,totalCount:l}}));function r(){u.value=!0,h("onFinished",u.value)}function k(){u.value=!1,h("onFinished",u.value)}const R=o=>{p.value.splice(o,1)};return B(()=>{const o=document.getElementById("ListProducts");o.focus(),o.onkeyup=s=>{s.which==13&&s.ctrlKey?r():s.which==27&&h("close")}}),(o,s)=>(f(),y("section",{onClick:s[5]||(s[5]=l=>o.$emit("close")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[e("main",{onClick:s[4]||(s[4]=N(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[v(F,{name:"scale"},{default:C(()=>[u.value?(f(),w(K,{key:0,onClose:k,onBackup:s[0]||(s[0]=l=>o.$emit("backup",l)),listProducts:_(d),totalPrice:_(a),sale:c.product},null,8,["listProducts","totalPrice","sale"])):D("",!0)]),_:1}),e("header",X,[Y,e("button",{onClick:s[1]||(s[1]=l=>o.$emit("close")),class:"px-4 py-2 hover:bg-pink-500"},ee)]),e("main",te,[e("table",se,[oe,(f(!0),y(G,null,T(p.value,(l,g)=>(f(),w(J,{refund:!0,product:l,key:g,onDelete:xe=>R(g)},null,8,["product","onDelete"]))),128)),e("tr",null,[le,ne,e("td",ae,V(_(a)),1),ie])])]),e("footer",re,[e("form",{onSubmit:s[3]||(s[3]=N(l=>t(),["prevent"]))},[j(e("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":s[2]||(s[2]=l=>m.value=l),placeholder:"Sotish ID-NNN"},null,512),[[z,m.value]])],32),e("main",null,[e("button",{onClick:r,class:"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"},ce)])])])]))}}),I=c=>(H("data-v-6e6639b3"),c=c(),Q(),c),pe={class:"flex flex-col"},me={class:"bg-white px-1 py-2 flex items-center"},fe=I(()=>e("label",{for:"searchInput"},null,-1)),he=I(()=>e("i",{class:"fal fa-search text-sm mr-4 relative top-px"},null,-1)),be={class:"flex-grow"},ge=$({__name:"SoldProducts",setup(c){const h=O(),i=W();axios.get("sale").then(({data:t})=>n.sells=t);const n=E({sells:null,editSold:null,columnDefs:[{headerName:"Mahsulotlar",flex:1,sortable:!0,cellRenderer:t=>{var a="";return t.data.sells.forEach(d=>{var r=d.count>1?`<span class="text-[10px] text-pink-500 mr-0.5">${d.count}x </span>`:"";a+=`
                    <div class="inline-block mr-4 ">
                        <span class="bg-gray-100 px-2 py-0.5 border-b border-pink-500">
                            <span>${d.product_names.name}</span>
                            <span class="ml-4 text-gray-400"> ${r} ${d.size.name}</span>
                        </span>
                    </div>`}),a}},{field:"cash",headerName:"Naxt",width:130},{field:"electron",headerName:"Plastik",width:130},{field:"debt",headerName:"Qarz",width:80},{field:"count",headerName:"Summa",width:140,headerClass:["bg-gray-100"],cellClass:["bg-gray-100","font-semibold"],cellRenderer:({data:t})=>t.cash+t.electron+t.debt},{field:"created_at",headerName:"Sotilgan vaqt",width:140,cellRenderer:t=>moment(t.value).fromNow()},{headerName:"",width:50,cellRenderer:()=>"<i class='fa-duotone fa-pen-nib text-pink-600 text-[16px] relative top-px'></i>",onCellClicked:t=>u(t.data),cellClass:["hover:bg-gray-200","text-center","active:bg-gray-300","bg-gray-100"]}]});function m(t){t==!1?(i.api.applyTransaction({remove:[n.editSold]}),n.editSold=null):(i.api.getRowNode(t.id).setData(t),n.editSold=null),h.getDayInfo()}function u(t){n.editSold=t}function p(t){i.api.applyTransaction({remove:[t]})}function b(t){i.api=t.api,i.columnApi=t.columnApi}return L(()=>{i.api=null,i.columnApi=null}),(t,a)=>{const d=U("AgGridVue");return f(),y("aside",pe,[v(M,{name:"fade"},{default:C(()=>[n.editSold!=null?(f(),w(ue,{key:0,onClose:a[0]||(a[0]=r=>n.editSold=null),onDeleted:p,onBackup:m,product:n.editSold},null,8,["product"])):D("",!0)]),_:1}),e("section",me,[fe,he,e("input",{onInput:a[1]||(a[1]=r=>_(i).api.setQuickFilter(r.target.value)),id:"searchInput",type:"text",class:"py-0.5 bg-inherit w-full outline-none",placeholder:"Izlash"},null,32)]),e("section",be,[v(d,{class:"h-full ag-theme-alpine w-full",headerHeight:30,getRowId:r=>r.data.id,rowData:n.sells,columnDefs:n.columnDefs,animateRows:!0,onGridReady:b},null,8,["getRowId","rowData","columnDefs"])])])}}});const ke=q(ge,[["__scopeId","data-v-6e6639b3"]]);export{ke as default};
