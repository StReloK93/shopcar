import{d as C,r as g,a as S,o as F,b as m,e as y,f as e,g as v,w as P,h as w,u as _,i as D,T,F as V,j,t as A,k as N,l as G,v as z,m as I,p as E,q as $,y as L,z as M,D as U,E as q,_ as Q}from"./app.c7992278.js";import{_ as H,a as K}from"./FinishedSold.vue_vue_type_script_setup_true_lang.d357c6d8.js";const J={class:"flex justify-between items-center bg-pink-600 border-b mb-0"},O=e("span",{class:"px-4 text-white"},[e("i",{class:"fa-duotone fa-pen-nib text-white relative top-px mr-3"}),I(" Tahrirlash ")],-1),W=e("i",{class:"far fa-times text-white"},null,-1),X=[W],Y={class:"flex-grow overflow-hidden overflow-y-auto list-products shadow-inner px-3"},Z={class:"w-full text-center mt-1"},ee=e("tr",null,[e("td",{class:"py-2 font-semibold"},"Nomi"),e("td",{class:"py-2 font-semibold"},"Hajmi"),e("td",{class:"py-2 font-semibold"},"Narxi"),e("td",{class:"py-2 font-semibold"},"Soni"),e("td",{class:"py-2 font-semibold"},"Do'kondagi soni"),e("td",{class:"py-2 font-semibold"},"Umumiy narxi")],-1),te=e("td",{class:"py-4 sticky bottom-0 bg-white",colspan:"4"},null,-1),se=e("td",{class:"py-3 sticky bottom-0 bg-white font-semibold text-[18px]"},"Umumiy summa",-1),oe={class:"py-4 sticky bottom-0 bg-white font-semibold text-[18px]"},le=e("td",{class:"py-4 sticky bottom-0 bg-white"},null,-1),ne={class:"bg-white p-3 border-t text-right flex justify-between items-center"},ae=e("span",{class:"text-gray-600"},[I(" Davom ettirish "),e("i",{class:"fa-light fa-arrow-right-long relative top-px ml-3 text-pink-500"})],-1),ie=[ae],re=C({__name:"RefundListProducts",props:["product"],emits:["close","deleted","onFinished","backup"],setup(c,{emit:f}){const{product:a}=c,x=E("getProductById",null),p=g(),u=g(!1),l=g([]),h=g([]);axios.get(`sale/${a.id}`).then(({data:o})=>{o.sells.forEach(s=>{s.totalCount=s.count}),l.value=o.sells,h.value=[...o.sells]});function t(){x(p.value),p.value=null}const i=S(()=>{const o=l.value.reduce((s,n)=>s+n.selled_price*n.totalCount,0);return Math.trunc(o*1e3)/1e3}),d=S(()=>h.value.map(o=>{const s=l.value.find(b=>o.id==b.id),n=o.count-s.totalCount;return{...s,totalCount:n}}));function r(){u.value=!0,f("onFinished",u.value)}function k(){u.value=!1,f("onFinished",u.value)}const B=o=>{l.value.splice(o,1)};return F(()=>{const o=document.getElementById("ListProducts");o.focus(),o.onkeyup=s=>{s.which==13&&s.ctrlKey?r():s.which==27&&f("close")}}),(o,s)=>(m(),y("section",{onClick:s[5]||(s[5]=n=>o.$emit("close")),tabindex:"0",id:"ListProducts",class:"full-absolute flex-center p-4 pb-16 outline-none z-[100]"},[e("main",{onClick:s[4]||(s[4]=N(()=>{},["stop"])),class:"min-w-[630px] w-[900px] bg-white h-full flex flex-col justify-between relative"},[v(T,{name:"scale"},{default:P(()=>[u.value?(m(),w(H,{key:0,onClose:k,onBackup:s[0]||(s[0]=n=>o.$emit("backup",n)),listProducts:_(d),totalPrice:_(i),sale:c.product},null,8,["listProducts","totalPrice","sale"])):D("",!0)]),_:1}),e("header",J,[O,e("button",{onClick:s[1]||(s[1]=n=>o.$emit("close")),class:"px-4 py-2 hover:bg-pink-500"},X)]),e("main",Y,[e("table",Z,[ee,(m(!0),y(V,null,j(l.value,(n,b)=>(m(),w(K,{refund:!0,product:n,key:b,onDelete:he=>B(b)},null,8,["product","onDelete"]))),128)),e("tr",null,[te,se,e("td",oe,A(_(i)),1),le])])]),e("footer",ne,[e("form",{onSubmit:s[3]||(s[3]=N(n=>t(),["prevent"]))},[G(e("input",{type:"text",class:"text-input bg-inherit border","onUpdate:modelValue":s[2]||(s[2]=n=>p.value=n),placeholder:"Sotish ID-NNN"},null,512),[[z,p.value]])],32),e("main",null,[e("button",{onClick:r,class:"py-1 px-3 bg-gray-200 shadow border-b-2 border-pink-500 hover:bg-pink-100 active:bg-pink-50"},ie)])])])]))}}),R=c=>(U("data-v-093a1b5a"),c=c(),q(),c),de={class:"flex flex-col"},ce={class:"bg-white px-1 py-2 flex items-center"},ue=R(()=>e("label",{for:"searchInput"},null,-1)),pe=R(()=>e("i",{class:"fal fa-search text-sm mr-4 relative top-px"},null,-1)),me={class:"flex-grow"},fe=C({__name:"SoldProducts",setup(c,{expose:f}){axios.get("sale").then(({data:t})=>a.sells=t);const a=$({sells:null,editSold:null,columnDefs:[{headerName:"Mahsulotlar",flex:1,sortable:!0,cellRenderer:t=>{var i="";return t.data.sells.forEach(d=>{var r=d.count>1?`<span class="text-[10px] text-pink-500 mr-0.5">${d.count}x </span>`:"";i+=`
                    <div class="inline-block mr-4 ">
                        <span class="bg-gray-100 px-2 py-0.5 border-b border-pink-500">
                            <span>${d.product_names.name}</span>
                            <span class="ml-4 text-gray-400"> ${r} ${d.size.name}</span>
                        </span>
                    </div>`}),i}},{field:"cash",headerName:"Naxt",width:130},{field:"electron",headerName:"Plastik",width:130},{field:"debt",headerName:"Qarz",width:80},{field:"count",headerName:"Summa",width:140,headerClass:["bg-gray-100"],cellClass:["bg-gray-100","font-semibold"],cellRenderer:({data:t})=>t.cash+t.electron+t.debt},{field:"created_at",headerName:"Sotilgan vaqt",width:140,cellRenderer:t=>moment(t.value).fromNow()},{headerName:"",width:50,cellRenderer:()=>"<i class='fa-duotone fa-pen-nib text-pink-600 text-[16px] relative top-px'></i>",onCellClicked:t=>p(t.data),cellClass:["hover:bg-gray-200","text-center","active:bg-gray-300","bg-gray-100"]}]});function x(t){t==!1?(l.api.applyTransaction({remove:[a.editSold]}),a.editSold=null):(l.api.getRowNode(t.id).setData(t),a.editSold=null)}function p(t){a.editSold=t}function u(t){l.api.applyTransaction({remove:[t]})}const l=$({api:null,columnApi:null});function h(t){l.api=t.api,l.columnApi=t.columnApi}return f({SellAgGrid:l}),(t,i)=>{const d=M("AgGridVue");return m(),y("aside",de,[v(L,{name:"fade"},{default:P(()=>[a.editSold!=null?(m(),w(re,{key:0,onClose:i[0]||(i[0]=r=>a.editSold=null),onDeleted:u,onBackup:x,product:a.editSold},null,8,["product"])):D("",!0)]),_:1}),e("section",ce,[ue,pe,e("input",{onInput:i[1]||(i[1]=r=>l.api.setQuickFilter(r.target.value)),id:"searchInput",type:"text",class:"py-0.5 bg-inherit w-full outline-none",placeholder:"Izlash"},null,32)]),e("section",me,[v(d,{class:"h-full ag-theme-alpine w-full",getRowId:r=>r.data.id,rowData:a.sells,columnDefs:a.columnDefs,animateRows:!0,onGridReady:h},null,8,["getRowId","rowData","columnDefs"])])])}}});const xe=Q(fe,[["__scopeId","data-v-093a1b5a"]]);export{xe as default};
